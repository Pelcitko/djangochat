(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{160:function(e,t,a){e.exports=a(329)},327:function(e,t,a){},329:function(e,t,a){"use strict";a.r(t);var n=a(0),s=a.n(n),r=a(3),o=a.n(r),c=a(48),l=a(19),i=a(144),u=(a(169),a(92)),m=function(e,t){return Object(u.a)({},e,t)},p="https://cryptic-plains-09325.herokuapp.com",h={token:null,username:null,error:null,loading:!1},d=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h,t=arguments.length>1?arguments[1]:void 0;switch(console.log("reducer:",e,t),t.type){case"AUTH_START":return function(e,t){return m(e,{error:null,loading:!0})}(e);case"AUTH_SUCCESS":return function(e,t){return m(e,{token:t.token,username:t.username,error:null,loading:!1})}(e,t);case"AUTH_FAIL":return function(e,t){return m(e,{error:t.error,loading:!1})}(e,t);case"AUTH_LOGOUT":return function(e,t){return m(e,{token:null,username:null})}(e);default:return e}},f={showAddChatPopup:!1},g=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"OPEN_ADD_CHAT_POPUP":return function(e,t){return m(e,{showAddChatPopup:!0})}(e);case"CLOSE_ADD_CHAT_POPUP":return function(e,t){return m(e,{showAddChatPopup:!1})}(e);default:return e}},E=a(91),v={messages:[],chats:[]},b=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:v,t=arguments.length>1?arguments[1]:void 0;switch(console.log("reducer:",e,t),t.type){case"ADD_MESSAGE":return function(e,t){return m(e,{messages:[].concat(Object(E.a)(e.messages),[t.message])})}(e,t);case"SET_MESSAGES":return function(e,t){return m(e,{messages:t.messages.reverse()})}(e,t);case"GET_CHATS_SUCCESS":return function(e,t){return m(e,{chats:t.chats})}(e,t);default:return e}},k=a(16),y=a(26),O=a(25),w=a(14),S=a(27),C=a(49),A=a(337),j=a(172),T=function(e){return e.children},D=function(){function e(){Object(k.a)(this,e),this.callbacks={},this.socketRef=null}return Object(w.a)(e,null,[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}]),Object(w.a)(e,[{key:"connect",value:function(e){var t=this,a="".concat("wss://cryptic-plains-09325.herokuapp.com","/ws/chat/").concat(e,"/");this.socketRef=new WebSocket(a),this.socketRef.onopen=function(){console.log("WebSocket open")},this.socketRef.onmessage=function(e){console.log(e.data),t.socketNewMessage(e.data)},this.socketRef.onerror=function(e){console.log(e.message)},this.socketRef.onclose=function(){console.log("WebSocket closed let's reopen"),t.connect()}}},{key:"disconnect",value:function(){this.socketRef.close()}},{key:"socketNewMessage",value:function(e){var t=JSON.parse(e),a=t.command;0!==Object.keys(this.callbacks).length&&("messages"===a&&this.callbacks[a](t.messages),"new_message"===a&&this.callbacks[a](t.message))}},{key:"fetchMessages",value:function(e,t){this.sendMessage({command:"fetch_messages",username:e,chatId:t})}},{key:"newChatMessage",value:function(e){this.sendMessage({command:"new_message",from:e.from,message:e.content,chatId:e.chatId})}},{key:"addCallbacks",value:function(e,t){this.callbacks.messages=e,this.callbacks.new_message=t}},{key:"sendMessage",value:function(e){try{this.socketRef.send(JSON.stringify(Object(u.a)({},e)))}catch(t){console.log(t.message)}}},{key:"state",value:function(){return this.socketRef.readyState}}]),e}();D.instance=null;var N=D.getInstance(),_=a(145),P=function(e){function t(e){var a;return Object(k.a)(this,t),(a=Object(y.a)(this,Object(O.a)(t).call(this,e))).state={message:""},a.messageChangeHandler=function(e){a.setState({message:e.target.value})},a.sendMessageHandler=function(e){e.preventDefault();var t={from:a.props.username,content:a.state.message,chatId:a.props.match.params.chatID};N.newChatMessage(t),a.setState({message:""})},a.renderTimestamp=function(e){var t=new Date(e),a=Math.round(((new Date).getTime()-t.getTime())/6e4);return a<1?"just now...":a<60&&a>1?"".concat(a," minutes ago"):a<1440&&a>60?"".concat(Math.round(a/60)," hours ago"):a<44640&&a>1440?"".concat(Math.round(a/1440)," days ago"):"".concat(_(t).format("LLLL"))},a.renderMessages=function(e){var t=a.props.username;return e.map(function(e,n,r){return s.a.createElement("li",{key:e.id,style:{marginBottom:r.length-1===n?"300px":"15px"},className:e.author===t?"sent":"replies"},s.a.createElement("img",{src:"https://loremflickr.com/320/320/dog,cat?random=".concat(e.author),alt:"profile-pic"}),s.a.createElement("p",null,e.content,s.a.createElement("br",null),s.a.createElement("small",null,a.renderTimestamp(e.timestamp))))})},a.scrollToBottom=function(){a.messagesEnd.scrollIntoView({behavior:"smooth"})},a.initialiseChat(),a}return Object(S.a)(t,e),Object(w.a)(t,[{key:"initialiseChat",value:function(){var e=this;this.waitForSocketConnection(function(){N.fetchMessages(e.props.username,e.props.match.params.chatID)}),N.connect(this.props.match.params.chatID)}}]),Object(w.a)(t,[{key:"waitForSocketConnection",value:function(e){var t=this;setTimeout(function(){1===N.state()?(console.log("Connection is made"),e()):(console.log("wait for connection..."),t.waitForSocketConnection(e))},100)}},{key:"componentDidMount",value:function(){this.scrollToBottom()}},{key:"componentDidUpdate",value:function(){this.scrollToBottom()}},{key:"componentWillReceiveProps",value:function(e){var t=this;this.props.match.params.chatID!==e.match.params.chatID&&(N.disconnect(),this.waitForSocketConnection(function(){N.fetchMessages(t.props.username,e.match.params.chatID)}),N.connect(e.match.params.chatID))}},{key:"render",value:function(){var e=this;return s.a.createElement(T,null,s.a.createElement("div",{className:"messages"},s.a.createElement("ul",{id:"chat-log"},this.props.messages&&this.renderMessages(this.props.messages),s.a.createElement("div",{style:{float:"left",clear:"both"},ref:function(t){e.messagesEnd=t}}))),s.a.createElement("div",{className:"message-input"},s.a.createElement("form",{onSubmit:this.sendMessageHandler},s.a.createElement("div",{className:"wrap"},s.a.createElement("input",{onChange:this.messageChangeHandler,value:this.state.message,required:!0,id:"chat-message-input",type:"text",placeholder:"Napi\u0161te zpr\xe1vu..."}),s.a.createElement("button",{id:"chat-message-submit",className:"submit"},s.a.createElement("i",{className:"fa fa-paper-plane","aria-hidden":"true"}))))))}}]),t}(s.a.Component),I=Object(l.b)(function(e){return{username:e.auth.username,messages:e.message.messages}})(P),M=function(){return s.a.createElement(T,null,s.a.createElement(j.a,{exact:!0,path:"/:chatID/",component:I}))},U=a(20),F=a(331),H=a(22),R=a.n(H),x=function(e,t){return console.log("user logged in..."),{type:"AUTH_SUCCESS",token:t,username:e}},L=function(e){return console.log(e),{type:"AUTH_FAIL",error:e}},G=function(){return localStorage.removeItem("token"),localStorage.removeItem("username"),localStorage.removeItem("expirationDate"),{type:"AUTH_LOGOUT"}},B=function(e){return function(t){setTimeout(function(){t(G())},1e3*e)}},z=function(e,t){return function(a){R.a.defaults.xsrfHeaderName="X-CSRFTOKEN",R.a.defaults.xsrfCookieName="csrftoken",R.a.defaults.headers={"Content-Type":"application/json",Authorization:"Token ".concat(t)},R.a.get("".concat(p,"/chat/?username=").concat(e)).then(function(e){return a((t=e.data,console.log(t),{type:"GET_CHATS_SUCCESS",chats:t}));var t})}},J=a(338),V=function(e){return s.a.createElement(J.a,{to:"".concat(e.chatURL),style:{color:"#fff"}},s.a.createElement("li",{className:"contact"},s.a.createElement("div",{className:"wrap"},s.a.createElement("span",{className:"contact-status active"}),s.a.createElement("img",{src:e.picURL,alt:"profile of ".concat(e.name)}),s.a.createElement("div",{className:"meta"},s.a.createElement("p",{className:"name"},e.name),s.a.createElement("p",{className:"preview"},e.messages)))))},W=s.a.createElement(U.a,{type:"loading",style:{fontSize:24},spin:!0}),X=function(e){function t(){var e,a;Object(k.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(y.a)(this,(e=Object(O.a)(t)).call.apply(e,[this].concat(s)))).state={loginForm:!0},a.changeForm=function(){a.setState({loginForm:!a.state.loginForm})},a.authenticate=function(e){e.preventDefault(),a.state.loginForm?a.props.login(e.target.username.value,e.target.password.value):a.props.signup(e.target.username.value,e.target.email.value,e.target.password.value,e.target.password2.value)},a}return Object(S.a)(t,e),Object(w.a)(t,[{key:"waitForAuthDetails",value:function(){var e=this;setTimeout(function(){null!==e.props.token&&void 0!==e.props.token?e.props.getUserChats(e.props.username,e.props.token):(console.log("waiting for authentication details..."),e.waitForAuthDetails())},100)}},{key:"componentDidMount",value:function(){this.waitForAuthDetails()}},{key:"openAddChatPopup",value:function(){this.props.addChat()}},{key:"render",value:function(){var e=this,t=this.props.chats.map(function(e){return s.a.createElement(V,{key:e.id,name:"".concat(e.participants.splice(0,1)),picURL:"https://loremflickr.com/320/320/dog,cat?random=".concat(e.id),status:"busy",chatURL:"/".concat(e.id),messages:"".concat(e.messages[0])})});return s.a.createElement("div",{id:"sidepanel"},s.a.createElement("div",{id:"profile"},s.a.createElement("div",{className:"wrap"},s.a.createElement("img",{id:"profile-img",src:"https://loremflickr.com/320/320/dog,cat?random=".concat(this.props.username),className:"online",alt:"User avatar",loading:"lazy"}),s.a.createElement("p",null,"Account"),s.a.createElement("i",{className:"fa fa-chevron-down expand-button","aria-hidden":"true"}),s.a.createElement("div",{id:"status-options"},s.a.createElement("ul",null,s.a.createElement("li",{id:"status-online",className:"active"},s.a.createElement("span",{className:"status-circle"})," ",s.a.createElement("p",null,"Online")),s.a.createElement("li",{id:"status-away"},s.a.createElement("span",{className:"status-circle"})," ",s.a.createElement("p",null,"Away")),s.a.createElement("li",{id:"status-busy"},s.a.createElement("span",{className:"status-circle"})," ",s.a.createElement("p",null,"Busy")),s.a.createElement("li",{id:"status-offline"},s.a.createElement("span",{className:"status-circle"})," ",s.a.createElement("p",null,"Offline")))),s.a.createElement("div",{id:"expanded"},this.props.loading?s.a.createElement(F.a,{indicator:W}):this.props.isAuthenticated?s.a.createElement("button",{onClick:function(){return e.props.logout()},className:"authBtn"},s.a.createElement("span",null,"Odahl\xe1sit")):s.a.createElement("div",null,s.a.createElement("form",{method:"POST",onSubmit:this.authenticate},this.state.loginForm?s.a.createElement("div",null,s.a.createElement("input",{name:"username",type:"text",placeholder:"username"}),s.a.createElement("input",{name:"password",type:"password",placeholder:"password"})):s.a.createElement("div",null,s.a.createElement("input",{name:"username",type:"text",placeholder:"username"}),s.a.createElement("input",{name:"email",type:"email",placeholder:"email"}),s.a.createElement("input",{name:"password",type:"password",placeholder:"password"}),s.a.createElement("input",{name:"password2",type:"password",placeholder:"password confirm"})),s.a.createElement("button",{type:"submit"},"authenticate")),s.a.createElement("button",{onClick:this.changeForm},"switch"))))),s.a.createElement("div",{id:"search"},s.a.createElement("label",{htmlFor:""},s.a.createElement("i",{className:"fa fa-search","aria-hidden":"true"})),s.a.createElement("input",{type:"text",placeholder:"Search Chats..."})),s.a.createElement("div",{id:"contacts"},s.a.createElement("ul",null,t)),s.a.createElement("div",{id:"bottom-bar"},s.a.createElement("button",{id:"addChat",onClick:function(){return e.openAddChatPopup()}},s.a.createElement("i",{className:"fa fa-user-plus fa-fw","aria-hidden":"true"}),s.a.createElement("span",null,"New connection")),s.a.createElement("button",{id:"settings"},s.a.createElement("i",{className:"fa fa-cog fa-fw","aria-hidden":"true"}),s.a.createElement("span",null,"Settings"))))}}]),t}(s.a.Component),q=Object(l.b)(function(e){return{isAuthenticated:null!==e.auth.token,loading:e.auth.loading,token:e.auth.token,username:e.auth.username,chats:e.message.chats}},function(e){return{login:function(t,a){return e(function(e,t){return function(a){a({type:"AUTH_START"}),R.a.post("".concat(p,"/rest-auth/login/"),{username:e,password:t}).then(function(t){var n=t.data.key,s=new Date((new Date).getTime()+36e5);localStorage.setItem("token",n),localStorage.setItem("username",e),localStorage.setItem("expirationDate",s),a(x(e,n)),a(B(3600))}).catch(function(e){console.log(e),a(L(e))})}}(t,a))},logout:function(){return e(G())},signup:function(t,a,n,s){return e(function(e,t,a,n){return function(s){s({type:"AUTH_START"}),R.a.post("".concat(p,"/rest-auth/registration/"),{username:e,email:t,password1:a,password2:n}).then(function(t){var a=t.data.key,n=new Date((new Date).getTime()+36e5);localStorage.setItem("token",a),localStorage.setItem("username",e),localStorage.setItem("expirationDate",n),s(x(e,a)),s(B(3600))}).catch(function(e){console.log(e),s(L(e))})}}(t,a,n,s))},addChat:function(){return e({type:"OPEN_ADD_CHAT_POPUP"})},getUserChats:function(t,a){return e(z(t,a))}}})(X),K=a(336),Q=function(e){function t(){return Object(k.a)(this,t),Object(y.a)(this,Object(O.a)(t).apply(this,arguments))}return Object(S.a)(t,e),Object(w.a)(t,[{key:"render",value:function(){return null===this.props.token?s.a.createElement(K.a,{to:"/"}):s.a.createElement("div",{className:"contact-profile"},null!==this.props.username?s.a.createElement(T,null,s.a.createElement("img",{src:"https://loremflickr.com/320/320/dog,cat?random=".concat(this.props.username),alt:"Avatar of ".concat(this.props.username)}),s.a.createElement("p",null,this.props.username),s.a.createElement("div",{className:"social-media"},s.a.createElement("i",{className:"fa fa-facebook","aria-hidden":"true"}),s.a.createElement("i",{className:"fa fa-twitter","aria-hidden":"true"}),s.a.createElement("i",{className:"fa fa-instagram","aria-hidden":"true"}))):null)}}]),t}(s.a.Component),Y=Object(l.b)(function(e){return{username:e.auth.username,token:e.auth.token}})(Q),Z=a(334),$=a(332),ee=a(333),te=a(87),ae=a(339),ne=$.a.Item;var se=function(e){function t(){var e,a;Object(k.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(y.a)(this,(e=Object(O.a)(t)).call.apply(e,[this].concat(s)))).state={usernames:[],error:null},a.handleChange=function(e){a.setState({usernames:e})},a.handleSubmit=function(e){var t=a.state.usernames;e.preventDefault(),a.props.form.validateFields(function(e,n){if(!e){var s=[].concat(Object(E.a)(t),[a.props.username]);R.a.defaults.xsrfHeaderName="X-CSRFTOKEN",R.a.defaults.xsrfCookieName="csrftoken",R.a.defaults.headers={"Content-Type":"application/json",Authorization:"Token ".concat(a.props.token)},R.a.post("".concat(p,"/chat/create/"),{messages:[],participants:s}).then(function(e){a.props.history.push("/".concat(e.data.id)),a.props.closeAddChatPopup(),a.props.getUserChats(a.props.username,a.props.token)}).catch(function(e){console.error(e),a.setState({error:e})})}})},a}return Object(S.a)(t,e),Object(w.a)(t,[{key:"componentDidMount",value:function(){this.props.form.validateFields()}},{key:"render",value:function(){var e,t=this.props.form,a=t.getFieldDecorator,n=t.getFieldsError,r=t.getFieldError,o=(0,t.isFieldTouched)("userName")&&r("userName");return s.a.createElement($.a,{layout:"inline",onSubmit:this.handleSubmit},this.state.error?"".concat(this.state.error):null,s.a.createElement(ne,{validateStatus:o?"error":"",help:o||""},a("userName",{rules:[{required:!0,message:"Please input the username of the person you want to chat with"}]})(s.a.createElement(ee.a,{mode:"tags",style:{width:"100%"},placeholder:"Tags Mode",onChange:this.handleChange},[]))),s.a.createElement(ne,null,s.a.createElement(te.a,{type:"primary",htmlType:"submit",disabled:(e=n(),Object.keys(e).some(function(t){return e[t]}))},"Start a chat")))}}]),t}(s.a.Component),re=$.a.create()(se),oe=Object(ae.a)(Object(l.b)(function(e){return{token:e.auth.token,username:e.auth.username}},function(e){return{closeAddChatPopup:function(){return e({type:"CLOSE_ADD_CHAT_POPUP"})},getUserChats:function(t,a){return e(z(t,a))}}})(re)),ce=function(e){function t(){return Object(k.a)(this,t),Object(y.a)(this,Object(O.a)(t).apply(this,arguments))}return Object(S.a)(t,e),Object(w.a)(t,[{key:"render",value:function(){return s.a.createElement(Z.a,{centered:!0,footer:null,visible:this.props.isVisible,onCancel:this.props.close},s.a.createElement(oe,null))}}]),t}(s.a.Component),le=(a(327),function(e){function t(e){var a;return Object(k.a)(this,t),a=Object(y.a)(this,Object(O.a)(t).call(this,e)),N.addCallbacks(a.props.setMessages.bind(Object(C.a)(Object(C.a)(a))),a.props.addMessage.bind(Object(C.a)(Object(C.a)(a)))),a}return Object(S.a)(t,e),Object(w.a)(t,[{key:"componentDidMount",value:function(){this.props.onTryAutoSignup()}}]),Object(w.a)(t,[{key:"render",value:function(){var e=this;return s.a.createElement(A.a,null,s.a.createElement("div",{id:"frame"},s.a.createElement(q,null),s.a.createElement("div",{className:"content"},s.a.createElement(ce,{isVisible:this.props.showAddChatPopup,close:function(){return e.props.closeAddChatPopup()}}),s.a.createElement(Y,null),s.a.createElement(M,null))))}}]),t}(s.a.Component)),ie=Object(l.b)(function(e){return{showAddChatPopup:e.nav.showAddChatPopup,authenticated:e.auth.token}},function(e){return{onTryAutoSignup:function(){return e(function(e){var t=localStorage.getItem("token"),a=localStorage.getItem("username");if(void 0===t)e(G());else{var n=new Date(localStorage.getItem("expirationDate"));n<=new Date?e(G()):(e(x(a,t)),e(B((n.getTime()-(new Date).getTime())/1e3)))}})},closeAddChatPopup:function(){return e({type:"CLOSE_ADD_CHAT_POPUP"})},addMessage:function(t){return e(function(e){return console.log(e),{type:"ADD_MESSAGE",message:e}}(t))},setMessages:function(t){return e(function(e){return console.log(e),{type:"SET_MESSAGES",messages:e}}(t))}}})(le),ue=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||c.d;var me=function(){var e=Object(c.c)({auth:d,nav:g,message:b});return Object(c.e)(e,ue(Object(c.a)(i.a)))}(),pe=s.a.createElement(l.a,{store:me},s.a.createElement(ie,null));o.a.render(pe,document.getElementById("app"))}},[[160,2,1]]]);
//# sourceMappingURL=main.886e17a6.chunk.js.map